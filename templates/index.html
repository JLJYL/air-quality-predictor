<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ city_name }} AQI 預測</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 使用 Inter 字體以保持現代感和清晰度 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9; /* Light grey background */
        }
        /* 針對不同 AQI 級別定義顏色 */
        .aqi-50 { @apply bg-green-500; } /* Good */
        .aqi-100 { @apply bg-yellow-500; } /* Moderate */
        .aqi-150 { @apply bg-orange-500; } /* Unhealthy for Sensitive Groups */
        .aqi-200 { @apply bg-red-600; } /* Unhealthy */
        .aqi-300 { @apply bg-purple-700; } /* Very Unhealthy */
        .aqi-default { @apply bg-gray-400; }

        /* 根據 AQI 數值返回對應的 Tailwind 類 */
        function getAqiColorClass(aqi) {
            if (aqi === "N/A" || isNaN(aqi) || aqi === null) return 'aqi-default';
            if (aqi <= 50) return 'aqi-50';
            if (aqi <= 100) return 'aqi-100';
            if (aqi <= 150) return 'aqi-150';
            if (aqi <= 200) return 'aqi-200';
            return 'aqi-300';
        }

        /* 讓滾動條隱藏，但仍可滾動 */
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        
        <!-- 標題區域 -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                {{ city_name }} 空氣品質預測
            </h1>
            <p class="text-lg text-gray-600">未來 {{ aqi_predictions | length if aqi_predictions else 24 }} 小時 AQI 趨勢</p>
            <p class="text-sm text-gray-400 mt-1">（數據初始化於應用程式啟動時完成）</p>
        </header>

        <!-- 主要資訊卡片：最大 AQI -->
        <div id="maxAqiCard" class="shadow-2xl rounded-xl p-6 md:p-8 mb-10 text-white transition duration-500 transform hover:scale-[1.01] flex flex-col md:flex-row justify-between items-center" 
             style="background-color: #2c3e50;">
            
            <div class="mb-4 md:mb-0">
                <p class="text-lg font-medium opacity-80">未來 24 小時內最大預測 AQI</p>
                <h2 id="maxAqiValue" class="text-6xl md:text-7xl font-black mt-1">
                    {{ max_aqi }}
                </h2>
            </div>
            
            <div id="aqiStatus" class="rounded-full px-6 py-2 text-xl font-bold shadow-md">
                {% if max_aqi == "N/A" %}
                    N/A
                {% elif max_aqi <= 50 %}
                    良好
                {% elif max_aqi <= 100 %}
                    普通
                {% elif max_aqi <= 150 %}
                    對敏感族群不健康
                {% elif max_aqi <= 200 %}
                    不健康
                {% else %}
                    非常不健康
                {% endif %}
            </div>
        </div>

        <!-- 預測細節列表 -->
        <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">逐小時預測明細</h3>
        
        <div id="predictionsList" class="space-y-3 max-h-[60vh] overflow-y-auto scrollbar-hide p-2 bg-white rounded-lg shadow-inner">
            {% if aqi_predictions %}
                {% for prediction in aqi_predictions %}
                <div class="flex justify-between items-center p-4 rounded-lg shadow-sm border border-gray-100 hover:bg-gray-50 transition duration-150">
                    <!-- 時間 -->
                    <span class="text-gray-600 font-medium text-sm md:text-base">
                        {{ prediction.time }} ({{ '現在 +%s 小時' % loop.index }})
                    </span>
                    
                    <!-- AQI 數值圓圈 -->
                    <div class="flex items-center space-x-3">
                        <span class="text-gray-700 font-semibold text-base md:text-lg">
                            AQI:
                        </span>
                        <span id="aqi-badge-{{ loop.index }}" class="w-10 h-10 flex items-center justify-center text-white text-base font-bold rounded-full shadow-md transition duration-300 ease-in-out" data-aqi="{{ prediction.aqi }}">
                            {{ prediction.aqi }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center p-10 text-gray-500">
                    <p class="mb-2 text-xl font-semibold">❌ 預測數據載入失敗</p>
                    <p>請檢查後端日誌，確認模型和數據是否已成功初始化。</p>
                </div>
            {% endif %}
        </div>

    </div>

    <script>
        // JavaScript 函數用於根據 AQI 數值動態套用顏色
        function updateAqiColors() {
            const maxAqiValue = document.getElementById('maxAqiValue').innerText.trim();
            const aqiStatusElement = document.getElementById('aqiStatus');
            const maxAqiCard = document.getElementById('maxAqiCard');
            const aqiColorClass = getAqiColorClass(parseInt(maxAqiValue));

            // 更新主卡片顏色
            if (maxAqiValue !== "N/A") {
                maxAqiCard.classList.remove('bg-gray-400'); // 移除預設顏色
                // 替換主卡片背景色為深藍色，以保持主視覺穩定，僅用文字標籤顏色標示狀態
                aqiStatusElement.classList.add(getAqiColorClass(parseInt(maxAqiValue))); 
                aqiStatusElement.classList.add('text-white');
            }


            // 更新列表中的小圓圈顏色
            document.querySelectorAll('[id^="aqi-badge-"]').forEach(badge => {
                const aqi = parseInt(badge.getAttribute('data-aqi'));
                if (!isNaN(aqi)) {
                    const colorClass = getAqiColorClass(aqi);
                    badge.classList.add(colorClass);
                }
            });
        }

        // 頁面載入完成後執行
        window.onload = updateAqiColors;
    </script>
</body>
</html>
